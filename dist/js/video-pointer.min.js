/**
 * @license Copyright 2016 Nathaniel Lord
 * http://fissionman924.github.io/videopointer/
 */
!function(t){"use strict";function e(e,i){return this.each(function(){var n=t(this),r=n.data("videopointer"),s="object"==typeof e&&e;r||n.data("videopointer",r=new o(this,s)),"string"==typeof e&&r[e](i)})}Math.radians=function(t){return t*Math.PI/180};var o=function(t,e){this.$element=null,this.options=null,this.init(t,e)};o.DEFAULTS={initialized:!1,endPointRadius:4,endPointStroke:2,lineColor:"#fff",line:{color:"#fff",width:2,style:"angled",angle:45},endPoint:{radius:0,stroke:0,style:"none",strokeColor:"#fff",fillColor:"#fff",url:""},anchorPoint:{radius:0,stroke:0,style:"none",strokeColor:"#fff",fillColor:"#fff",url:""},videoSelector:"video",itemSelector:".pointer-item",anchorSelector:".pointer-anchor",debug:!1},o.prototype.init=function(e,o){var i=this;this.$element=t(e),this.options=this.getOptions(o),this.state={},this.generatePoints.apply(this),this.$element.on("mouseenter focus",i.options.itemSelector,function(e){var o=t(i.options.itemSelector,i.$element).index(e.currentTarget),n=i.options.points[o].time,r=t(i.options.videoSelector,i.$element)[0];return void 0===n?!1:(r.currentTime=n,void(r.paused||r.pause()))}).on("mouseleave blur",i.options.itemSelector,function(e){var o=t(i.options.videoSelector,i.$element)[0];o.paused&&o.play()}),t(window).on("resize",function(t){i.generatePoints.apply(i)}),t(i.options.videoSelector,this.$element).on("canplay",function(t){i.generatePoints.apply(i)})};var i=function(t,e){var o;if(typeof t!=typeof e)return!1;if(null===t||null===e&&t!==e)return!1;if(Array.isArray(t)){if(t.length!=e.length)return!1;for(t.sort(),e.sort(),o=0;o<t.length;o++)if(!i(t[o],e[o]))return!1}else{if("object"!=typeof t)return t===e;var n=Object.keys(t),r=Object.keys(e);if(!i(n,r))return!1;for(o=0;o<n.length;o++)if(!i(t[n[o]],e[r[o]]))return!1}return!0};o.prototype.clearImages=function(){t(".pointer",this.$element).replaceWith("")},o.prototype.rerender=function(){this.state={},this.clearImages.apply(this),this.generatePoints.apply(this)},o.prototype.generatePoints=function(){var e=this,o=(this.options.points,this.options.line.angle),y=!1,f=t(t(e.options.videoSelector,this.$element)[0]),p=a(f),x=[],u=r.apply(this);t(u,this.$element).each(function(e,o){var i=t(o),n=a(i);x.push(n)}),void 0!==e.state.vid&&void 0!==e.state.items&&i(e.state.vid,p)&&i(e.state.items,x)||(e.state.vid=p,e.state.items=x,e.clearImages.apply(e),y=!0),y&&t(u,this.$element).each(function(i,r){var y=e.options.points[i];if(void 0===y)return!1;var f=!1,x={x:0,y:0},u={x:0,y:0},m={x:0,y:0};x.x=y.x/100*p.w+p.x,x.y=y.y/100*p.h+p.y;var v=t(r),g=a(v);d(p,g)?(f=!0,g.y>p.y+p.h?u.y=g.y:u.y=g.y+g.h,u.x=g.x+g.w/2):(g.x>p.x+p.w?u.x=g.x:u.x=g.x+g.w,u.y=g.y+g.h/2),e.options.debug&&(n(u.x,u.y),n(x.x,x.y));var M=e.options.endPoint.fillColor;void 0!==y.color&&(M=y.color),"straight"===e.options.line.style?t.extend(m,u):m=h(u,x,o,f),c.call(e,y,x,m,u,M,function(t){s.call(e,y,r,u,l(v),x,f,t)})})};var n=function(e,o){var i=t("<div class='point'></div>");i.css({position:"absolute",left:e-3+"px",top:o-3+"px",height:"6px",width:"6px","border-radius":"50%","background-color":"white","z-index":"10000"}),t("body").append(i)},r=function(){var e=this.options.anchorSelector;return 0===t(e,this.$element).length&&(e=this.options.itemSelector),e},s=function(e,o,i,n,s,a,l){var d=this;t(l).css({"max-width":"none","min-width":"none","max-height":"none","min-height":"none",position:"absolute"});var h=t.extend(!0,{},this.options.endPoint,e.endPoint),c=t.extend(!0,{},this.options.anchorPoint,e.anchorPoint),y=(t.extend(!0,{},this.options.line,e.line),r.apply(this)),f={x:0,y:0};d.options.itemSelector===y?("static"===t(o).parents(d.options.itemSelector).css("position")?(f.x=t(o).offset().left-t(o).offsetParent().offset().left,f.y=t(o).offset().top-t(o).offsetParent().offset().top):(f.x=0,f.y=0),t(o).append(l)):("static"===t(o).parents(d.options.itemSelector).css("position")?(f.x=t(o).offset().left-t(o).parents(d.options.itemSelector).offsetParent().offset().left,f.y=t(o).offset().top-t(o).parents(d.options.itemSelector).offsetParent().offset().top):(f.x=t(o).offset().left-t(o).parents(d.options.itemSelector).offset().left,f.y=t(o).offset().top-t(o).parents(d.options.itemSelector).offset().top),t(o).parents(d.options.itemSelector).append(l));var p=1,x=1,u=h.radius>c.radius?2*h.radius:c.radius;t(l).height()<=u?p=h.radius+h.stroke-Math.abs(i.y-s.y):p+=c.radius,t(l).width()<=u?x=h.radius+h.stroke-Math.abs(i.x-s.x):x+=c.radius;var m={left:0,top:0};a?(s.x>i.x?m.left=f.x:m.left=f.x-l.width,s.y>i.y?m.top=f.y-p:m.top=f.y-l.height+p):(s.x>i.x?m.left=f.x:m.left=f.x-l.width,s.y>i.y?m.top=f.y+n.h/2-p:m.top=f.y+n.h/2+p-l.height),t(l).css({top:m.top+"px",left:m.left+"px"}).addClass("pointer")},a=function(t){var e={x:t.offset().left+parseInt(t.css("padding-left"))+parseInt(t.css("border-left-width")),y:t.offset().top+parseInt(t.css("padding-top"))+parseInt(t.css("border-top-width")),w:t.width(),h:t.height()};return e},l=function(t){var e={x:t.position().left+parseInt(t.css("padding-left"))+parseInt(t.css("border-left-width")),y:t.position().top+parseInt(t.css("padding-top"))+parseInt(t.css("border-top-width")),w:t.width(),h:t.height()};return e},d=function(t,e){var o=!1;return e.x>=t.x&&e.x<=t.x+t.w&&(e.y>t.y+t.h||e.y+e.h<t.y)&&(o=!0),o},h=function(t,e,o,i){var n={x:0,y:0},r={A:o,B:90,C:180-o-90},s={a:Math.abs(e.y-t.y),b:0,c:0};return i&&(s.a=Math.abs(e.x-t.x)),s.b=s.a*Math.sin(Math.radians(r.B))/Math.sin(Math.radians(r.A)),s.c=s.a*Math.sin(Math.radians(r.C))/Math.sin(Math.radians(r.A)),i?(e.y>t.y?n.y=e.y-s.c:n.y=e.y+s.c,Math.abs(e.y-t.y)<Math.abs(e.x-t.x)&&(n.y=e.y),n.x=t.x):(e.x>t.x?n.x=e.x-s.c:n.x=e.x+s.c,Math.abs(e.x-t.x)<Math.abs(e.y-t.y)&&(n.x=e.x),n.y=t.y),n},c=function(e,o,i,n,r,s){var a=new Image,l=this,d={anchor:{},mid:{},end:{}},h=n.x===i.x&&n.y!==i.y,c=t.extend(!0,{},this.options.endPoint,e.endPoint),p=t.extend(!0,{},this.options.anchorPoint,e.anchorPoint),x=t.extend(!0,{},this.options.line,e.line),v={w:Math.ceil(Math.abs(n.x-o.x)+c.radius+p.radius+6),h:Math.ceil(Math.abs(o.y-n.y)+c.radius+p.radius+6)},g=document.createElement("canvas");g.height=v.h,g.width=v.w;var M=g.getContext("2d");if(Math.floor(this.options.line.width)%2===1){var b=.5;o.y<n.y&&(b=-.5),M.translate(.5,b)}var w=0;if(Math.abs(n.y-o.y)<=c.radius&&(w=this.options.endPoint.radius+2-Math.abs(n.y-o.y),0>w&&(w=0)),o.x>n.x?(d.anchor.x=1+p.radius,d.mid.x=Math.ceil(i.x-n.x)+d.anchor.x,d.end.x=Math.ceil(o.x-n.x)+d.anchor.x):(d.anchor.x=Math.ceil(v.w-1-p.radius),d.mid.x=d.anchor.x-Math.ceil(n.x-i.x),d.end.x=d.anchor.x-Math.ceil(n.x-o.x)),o.y>n.y?(d.anchor.y=1+p.radius,d.mid.y=Math.ceil(i.y-n.y)+d.anchor.y,d.end.y=Math.ceil(o.y-n.y)+d.anchor.y):n.y>o.y&&(d.anchor.y=Math.ceil(v.h-w-1-p.radius),d.mid.y=d.anchor.y-Math.ceil(n.y-i.y-w),d.end.y=d.anchor.y-Math.ceil(n.y-o.y-w)),"angled"===x.style)m(M,[d.anchor,d.mid,d.end],x.width,x.color);else if("straight"===x.style)m(M,[d.anchor,d.end],x.width,x.color);else if("curved"===x.style){var P=100,S={x:0,y:0},k={x:0,y:0};d.mid.x===d.anchor.x&&d.mid.y===d.end.y?(S.x=d.anchor.x,k.y=d.end.y,P>d.mid.y&&(P=d.mid.y),Math.abs(d.mid.x-d.end.x)<P&&(P=Math.abs(d.mid.x-d.end.x)),d.anchor.y<d.end.y?S.y=d.mid.y-P:S.y=d.mid.y-P,d.anchor.x>d.end.x?k.x=d.mid.x-P:k.x=d.mid.x+P,u(M,[d.anchor,S,k,d.end],x.width,x.color,h)):d.mid.y===d.anchor.y&&d.mid.x===d.end.x?(S.y=d.anchor.y,k.x=d.end.x,P>d.mid.x&&(P=d.mid.x),Math.abs(d.mid.y-d.end.y)<P&&(P=Math.abs(d.mid.y-d.end.y)),d.anchor.x<d.end.x?S.x=d.mid.x-P:S.x=d.mid.x+P,d.anchor.y>d.end.y?k.y=d.mid.y-P:k.y=d.mid.y+P,u(M,[d.anchor,S,k,d.end],x.width,x.color,h)):u(M,[d.anchor,d.mid,d.end],x.width,x.color,h)}y.call(l,M,d.anchor,p,function(){f.call(l,M,d.end,c,function(){a.src=g.toDataURL("image/png"),s(a)})})},y=function(t,e,o,i){"circle"===o.style?v(t,e,o.radius,o.stroke,o.fillColor,o.strokeColor):"square"===o.style&&g(t,e,o.radius,o.stroke,o.fillColor,o.strokeColor),"image"===o.style&&""!==o.url?x(t,e,o.url,o.radius,i):i.call(this)},f=function(t,e,o,i){"circle"===o.style?v(t,e,o.radius,o.stroke,o.fillColor,o.strokeColor):"square"===o.style&&g(t,e,o.radius,o.stroke,o.fillColor,o.strokeColor),"image"===o.style&&""!==o.url?x(t,e,o.url,o.radius,i):i.call(this)},p=function(t){var e=!1,o=document.createElement("canvas"),i=o.getContext("2d");i.drawImage(t,1,1);try{o.toDataURL();e=!0}catch(n){console.log("The image specified for the endpoint is not a valid image for cross origin resource sharing")}return e},x=function(t,e,o,i,n){var r=document.createElement("img");r.src=o,r.crossOrigin="Anonymous",r.onload=function(){p(r)&&t.drawImage(r,e.x,e.y,i,i),n()},r.onerror=function(){console.log("Couldn't load the endpoint image. Please make sure it's hosted on your sire, is a valid cross origin image, is not located in a file path, and is accessible."),n()}},u=function(t,e,o,i,n){t.beginPath(),t.strokeStyle=i,t.lineWidth=o,t.moveTo(e[0].x,e[0].y);for(var r={x:0,y:0},s={x:0,y:0},a={x:0,y:0},l=1;l<e.length;l++)r=e[l],a=e[l-1],n?(s.x=a.x,s.y=r.y):(s.x=r.x,s.y=a.y),t.quadraticCurveTo(s.x,s.y,r.x,r.y);t.stroke()},m=function(t,e,o,i){t.beginPath(),t.strokeStyle=i,t.lineWidth=o,t.moveTo(e[0].x,e[0].y);for(var n,r=1;r<e.length;r++)n=e[r],t.lineTo(n.x,n.y);t.stroke()},v=function(t,e,o,i,n,r){t.beginPath(),t.strokeStyle=r,t.fillStyle=n,t.lineWidth=i,t.arc(e.x,e.y,o,0,2*Math.PI,!1),i>0&&t.stroke(),t.fill()},g=function(t,e,o,i,n,r){t.beginPath(),t.strokeStyle=r,t.fillStyle=n,t.lineWidth=i,i>0&&(t.rect(e.x-o,e.y-o,2*o,2*o),t.stroke()),t.fillRect(e.x-o,e.y-o,2*o,2*o)};o.prototype.getOptions=function(e){var o=t.extend(!0,{},this.getDefaults(),this.$element.data(),e);return o},o.prototype.getDefaults=function(){return o.DEFAULTS},o.prototype.destroy=function(){delete this.options,delete this.$element};var M=t.fn.videopointer;t.fn.videopointer=e,t.fn.videopointer.Constructor=o,t.fn.videopointer.noConflict=function(){return t.fn.videopointer=M,this}}(jQuery);